// This file is generated by Save As Snippet
// For detail, check vscode snippet syntax 
// https://code.visualstudio.com/docs/editor/userdefinedsnippets#_creating-your-own-snippets
{
	"Get Users Of Group": {
	  "prefix": "Get Users Of Group",
	  "scope": "sql",
	  "body": [
		"DECLARE @MyTempTable TABLE\r",
		"(\r",
		"\tEntityId int\r",
		");\r",
		"\t\r",
		"INSERT INTO @MyTempTable\r",
		"EXEC [Security].[GetUsersOfGroup] '$1'\r",
		"SELECT Trigram, Lastname + ' ' + Firstname AS 'Full Name' FROM Employee WHERE EmployeeId IN (SELECT EntityId FROM @MyTempTable)"
	  ],
	  "description": "Get Users Of A Group"
	},
	"Update Permission all item in table": {
	  "prefix": "Update Permission",
	  "scope": "sql",
	  "body": [
		"EXEC Security.UpdatePermAllItems  @TableName = N'$1', @SchemaName = N'dbo'"
	  ],
	  "description": "Security.UpdatePermAllItems"
	},
	"Get Executive Assistant": {
	  "prefix": "Get Executive Assistant",
	  "scope": "sql",
	  "body": [
		"DECLARE @MyTempTable TABLE\r",
		"(\r",
		"\t[EmployeeId] [int] NOT NULL,\t[Email] [nvarchar](100) NULL,\t[Login] [nvarchar](150) NULL,\t[Firstname] [nvarchar](50) NOT NULL,\t[Lastname] [nvarchar](50) NOT NULL,\r",
		"\t[ManagerId] [int] NULL,\t[WorkingForId] [int] NULL,\t[EmployedById] [int] NOT NULL,\t[HostCompanyId] [int] NULL,\t[Trigram] [nchar](5) NULL,\r",
		"\t[ManagerTrigram] [nchar](5) NULL,\t[UpdatedDate] [datetime2](7) NULL,\t[CreatedBy] [int] NULL,\t[UpdatedBy] [int] NULL,\t[CreatedDate] [datetime2](7) NULL,\r",
		"\t[EmployeeTypeId] [int] NULL,\t[EmployeeStatusId] [int] NULL,\t[EntryDate] [datetime2](7) NULL,\t[LocationId] [int] NULL,\r",
		"\t[EvaluationDate] [datetime2](7) NULL,\t[CandidateId] [int] NULL,\t[TransferDate] [datetime2](7) NULL,\t[ExitDate] [datetime2](7) NULL,\r",
		"\t[Disabled] [bit] NOT NULL,\t[RoleReadId] [int] NULL,\t[RoleContributeId] [int] NULL,\t[OfficeId] [int] NULL,\t[AdminFileId] [int] NOT NULL,\r",
		"\t[RoleId] [bigint] NULL\r",
		");\r",
		"\t\r",
		"INSERT INTO @MyTempTable\r",
		"EXEC [Security].[GetExecutiveAssistants] $1\r",
		"\r",
		"SELECT MT.EmployeeId, MT.Lastname + ' ' + MT.Firstname 'Employee Full Name', DT.Label\r",
		"FROM @MyTempTable MT \r",
		"JOIN Employee_Delegation ED ON MT.EmployeeId = ED.ExecutiveAssistantId AND ED.[Disabled] <> 1\r",
		"JOIN [Security].DelegationType DT ON ED.TypeId = DT.DelegationTypeId\r",
		"WHERE ED.EmployeeId = $2"
	  ],
	  "description": "Get Executive Assistant"
	},
	"Update ACL": {
	  "prefix": "Update ACL",
	  "scope": "sql",
	  "body": [
		"UPDATE [Security].[ACL]\r",
		"SET IsValidated = $1\r",
		"WHERE ACLId =$2\r",
		"\r",
		"EXEC Security.UpdatePermAllItems  @TableName = N'Employee', @SchemaName = N'dbo'"
	  ],
	  "description": ""
	},
	"Fix SID Different": {
	  "prefix": "Fix SID Different",
	  "scope": "sql",
	  "body": [
		"DECLARE @Command VARCHAR(MAX) = 'ALTER AUTHORIZATION ON DATABASE::[SMART_Amaris] TO \r",
		"[hdang-pc\\hdang]' \r",
		"\r",
		"SELECT @Command = REPLACE(REPLACE(@Command \r",
		"            , 'SMART_Amaris', SD.Name)\r",
		"            , 'hdang-pc\\hdang', SL.Name)\r",
		"FROM master..sysdatabases SD \r",
		"JOIN master..syslogins SL ON  SD.SID = SL.SID\r",
		"WHERE  SD.Name = DB_NAME()\r",
		"\r",
		"PRINT @Command\r",
		"EXEC(@Command)\r",
		"\r",
		"CREATE AGGREGATE [dbo].[SumFlag]\r",
		"(@flag [int])\r",
		"RETURNS[int]\r",
		"EXTERNAL NAME [SumFlag].[SumFlag]\r",
		"GO\r",
		"\r",
		"CREATE ASSEMBLY [SumFlag]\r",
		"FROM 0x4D5A90000300000004000000FFFF0000B800000000000000400000000000000000000000000000000000000000000000000000000000000000000000800000000E1FBA0E00B409CD21B8014CCD21546869732070726F6772616D2063616E6E6F742062652072756E20696E20444F53206D6F64652E0D0D0A2400000000000000504500004C01030053955D560000000000000000E00002210B010B00000A000000060000000000002E290000002000000040000000000010002000000002000004000000000000000600000000000000008000000002000000000000030060850000100000100000000010000010000000000000100000000000000000000000D42800005700000000400000A002000000000000000000000000000000000000006000000C0000009C2700001C0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000080000000000000000000000082000004800000000000000000000002E746578740000003409000000200000000A000000020000000000000000000000000000200000602E72737263000000A00200000040000000040000000C0000000000000000000000000000400000402E72656C6F6300000C000000006000000002000000100000000000000000000000000000400000420000000000000000000000000000000010290000000000004800000002000500382100006406000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001E027B010000042A2202037D010000042A1E027B020000042A2202037D020000042A520216280800000A2802000006021628040000062A00133005005F000000010000110228030000062D180F01280900000A2D0F02032802000006021728040000062A0228010000060A1200280900000A2C012A0F01280900000A2C012A020228010000060302280100000603280A00000A280B00000A280C00000A28020000062AE60F0128030000062C2F020228010000060F0128010000060228010000060F012801000006280A00000A280B00000A280C00000A28020000062A1E0228010000062A00000042534A4201000100000000000C00000076342E302E33303331390000000005006C00000040020000237E0000AC0200009402000023537472696E67730000000040050000080000002355530048050000100000002347554944000000580500000C01000023426C6F6200000000000000020000015715A2010900000000FA253300160000010000000C000000020000000200000008000000040000000C0000000A00000001000000010000000200000004000000010000000200000000000A0001000000000006002E0027000A00590044000600180105010F002C01000006006101410106008101410106009F0127000A00D001B5010A00F101B50106001702F80106002D02F801060038024101000000000100000000000100010009211000160000000500010001000100B20028000100CA002C00502000000000860862000A00010058200000000081086D000F00010061200000000086087800150002006920000000008108850019000200722000000000860092001E000300882000000000860097000F000300F320000000008600A200220004002D21000000008600A8000A00050000000100F40000000100F40000000100FA0000000100FF0019003B01380029003B013E0031003B011E0039003B011E0041003B01430051003B01B90061003B011E0011005302C40011005F02150011006A02CA0011007802CA0011008702CA0020003B00BF0021003B00BF002E001300E1002E000B00D8002E001B00EA0040003B00BF0041003B00BF0043002B00490060003B00BF0080003B00BF00D300020001000000E4002F000000EB0034000200010003000100020003000200030005000100040005000480000000000000000000000000000000001600000004000000000000000000000001001E000000000004000000000000000000000001003800000000000000003C4D6F64756C653E0053756D466C61672E646C6C0053756D466C6167006D73636F726C69620053797374656D0056616C7565547970650053797374656D2E446174610053797374656D2E446174612E53716C54797065730053716C496E743332006765745F526573756C74007365745F526573756C74006765745F48617356616C7565007365745F48617356616C756500496E697400416363756D756C617465004D65726765005465726D696E617465003C526573756C743E6B5F5F4261636B696E674669656C64003C48617356616C75653E6B5F5F4261636B696E674669656C6400526573756C740048617356616C75650076616C756500666C61670067726F75700053797374656D2E446961676E6F73746963730044656275676761626C6541747472696275746500446562756767696E674D6F646573002E63746F720053797374656D2E52756E74696D652E436F6D70696C6572536572766963657300436F6D70696C6174696F6E52656C61786174696F6E734174747269627574650052756E74696D65436F6D7061746962696C6974794174747269627574650053657269616C697A61626C65417474726962757465004D6963726F736F66742E53716C5365727665722E5365727665720053716C55736572446566696E656441676772656761746541747472696275746500466F726D61740053797374656D2E52756E74696D652E496E7465726F705365727669636573005374727563744C61796F7574417474726962757465004C61796F75744B696E6400436F6D70696C657247656E657261746564417474726962757465006F705F496D706C69636974006765745F49734E756C6C006F705F42697477697365416E64006F705F5375627472616374696F6E006F705F4164646974696F6E00000003200000000000EF32AEE96A47684EAEF9E7F6431158010008B77A5C561934E0890420001109052001011109032000020420010102032000010520010111080306110902060204280011090328000205200101111104200101080520010111256F01000100000005005402174973496E76617269616E74546F4475706C696361746573015402124973496E76617269616E74546F4E756C6C73005402124973496E76617269616E74546F4F726465720154020D49734E756C6C4966456D70747901540E044E616D650753756D466C616705200101112D040100000005000111090808000211091109110904070111090801000200000000000801000800000000001E01000100540216577261704E6F6E457863657074696F6E5468726F7773010000000000000053955D5600000000020000001C010000B8270000B80900005253445324A612AF09C7BD47B1B72CA1DF1636E308000000633A5C55736572735C41647269656E5C446F63756D656E74735C56697375616C2053747564696F20323031355C50726F6A656374735C5465737453514C50726F6A6563745C5465737453514C50726F6A6563745C6F626A5C52656C656173655C53756D466C61672E706462000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000FC28000000000000000000001E290000002000000000000000000000000000000000000000000000102900000000000000000000000000000000000000005F436F72446C6C4D61696E006D73636F7265652E646C6C0000000000FF250020001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100100000001800008000000000000000000000000000000100010000003000008000000000000000000000000000000100000000004800000058400000440200000000000000000000440234000000560053005F00560045005200530049004F004E005F0049004E0046004F0000000000BD04EFFE00000100000000000000000000000000000000003F000000000000000400000002000000000000000000000000000000440000000100560061007200460069006C00650049006E0066006F00000000002400040000005400720061006E0073006C006100740069006F006E00000000000000B004A4010000010053007400720069006E006700460069006C00650049006E0066006F0000008001000001003000300030003000300034006200300000002C0002000100460069006C0065004400650073006300720069007000740069006F006E000000000020000000300008000100460069006C006500560065007200730069006F006E000000000030002E0030002E0030002E003000000038000C00010049006E007400650072006E0061006C004E0061006D0065000000530075006D0046006C00610067002E0064006C006C0000002800020001004C006500670061006C0043006F00700079007200690067006800740000002000000040000C0001004F0072006900670069006E0061006C00460069006C0065006E0061006D0065000000530075006D0046006C00610067002E0064006C006C000000340008000100500072006F006400750063007400560065007200730069006F006E00000030002E0030002E0030002E003000000038000800010041007300730065006D0062006C0079002000560065007200730069006F006E00000030002E0030002E0030002E00300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000C000000303900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000\r",
		"WITH PERMISSION_SET = SAFE\r",
		"GO"
	  ],
	  "description": "The database owner SID recorded in the master database differs from the database owner SID recorded"
	},  
	"Restore From Backup": {
	  "prefix": "Restore From Backup",
	  "scope": "sql",
	  "body": [
		"USE master\r",
		"ALTER DATABASE SMART_Amaris\r",
		"Modify Name = SMART_Amaris_Old;\r",
		" \r",
		"ALTER DATABASE SMART_Amaris_TO_CLEAN\r",
		"Modify Name = SMART_Amaris;\r",
		" \r",
		"USE SMART_Amaris\r",
		"UPDATE [dbo].[Employee]\r",
		"SET Login = \r",
		"'hdang-pc\\hdang'\t\t\t  -- AT WORK\r",      
		"WHERE EmployeeId = 6424\r",
		"\r"
	  ],
	  "description": "Restore info after Backup"
	},
	"Search For Employee": {
	  "prefix": "Search For Employee",
	  "scope": "sql",
	  "body": [
		"DECLARE @employeeid int = 5183\r",
		"DECLARE @trigram varchar(max) = ''\r",
		"DECLARE @lastname varchar(max) = ''\r",
		"DECLARE @firstname varchar(max) = ''\r",
		"DECLARE @managerid int = 0\r",
		"DECLARE @managertrg varchar(max) = ''\r",
		"DECLARE @managerlname varchar(max) = ''\r",
		"DECLARE @managerfname varchar(max) = ''\r",
		"\r",
		"SELECT emp.EmployeeId, emp.Trigram 'Emp Trigram', \r",
		"emp.Lastname + ' ' + emp.Firstname 'Employee Fullname',\r",
		"man.EmployeeId 'ManagerId', man.Trigram 'Manager Trigram'\r",
		", man.Lastname + ' ' + man.Firstname 'Manager Fullname'\r",
		", EMP.[Disabled]\r",
		"FROM Employee emp JOIN Employee man ON emp.ManagerId = man.EmployeeId\r",
		"WHERE @employeeid <> 0 AND emp.EmployeeId = @employeeid\r",
		"    OR @trigram <> '' AND emp.Trigram = @trigram\r",
		"    OR @lastname <> '' AND emp.Lastname LIKE @lastname\r",
		"    OR @firstname <> '' AND emp.Firstname LIKE @firstname\r",
		"    OR @managerid <> 0 AND emp.ManagerId = @managerid\r",
		"    OR @managertrg <> '' AND man.Trigram = @managertrg\r",
		"    OR @managerlname <> '' AND man.Lastname LIKE @managerlname\r",
		"    OR @managerfname <> '' AND man.Firstname LIKE @managerfname"
	  ],
	  "description": "Search employee"
	},
	"Transfer Analysis": {
	  "prefix": "Transfer Analysis",
	  "scope": "sql",
	  "body": [
		"DECLARE @employeeid int = 1643\r",
		"DECLARE @managerTypeId int = 2\r",
		"DECLARE @trigram varchar(max) = ''\r",
		"DECLARE @lastname varchar(max) = ''\r",
		"DECLARE @firstname varchar(max) = ''\r",
		"DECLARE @managerid int = 0\r",
		"DECLARE @managertrg varchar(max) = ''\r",
		"DECLARE @managerlname varchar(max) = ''\r",
		"DECLARE @managerfname varchar(max) = ''\r",
		"\r",
		"SELECT emp.EmployeeId, emp.Trigram 'Emp Trigram', emp.Lastname + ' ' + emp.Firstname 'Employee Fullname'\r",
		"       ,man.EmployeeId 'ManagerId', man.Trigram 'Manager Trigram', man.Lastname + ' ' + man.Firstname 'Manager Fullname'\r",
		"     \r",
		"FROM Employee emp \r",
		"JOIN Employee man ON emp.ManagerId = man.EmployeeId\r",
		"WHERE @employeeid <> 0 AND emp.EmployeeId = @employeeid\r",
		"    OR @trigram <> '' AND emp.Trigram = @trigram\r",
		"    OR @lastname <> '' AND emp.Lastname LIKE @lastname\r",
		"    OR @firstname <> '' AND emp.Firstname LIKE @firstname\r",
		"    OR @managerid <> 0 AND emp.ManagerId = @managerid\r",
		"    OR @managertrg <> '' AND man.Trigram = @managertrg\r",
		"    OR @managerlname <> '' AND man.Lastname LIKE @managerlname\r",
		"    OR @managerfname <> '' AND man.Firstname LIKE @managerfname\r",
		"\r",
		"SELECT EMPM.EmployeeManagerId, EMPM.EmployeeId, EMPM.ManagerId, \r",
		"MAN.Lastname + ' ' + MAN.Firstname 'Manager Fullname',\r",
		"EMPM.ManagerTypeId, MT.Label\r",
		"FROM Employee_Manager EMPM \r",
		"JOIN ManagerType MT ON MT.ManagerTypeId = EMPM.ManagerTypeId\r",
		"JOIN Employee EMP ON EMPM.EmployeeId = EMP.EmployeeId\r",
		"JOIN Employee MAN ON EMPM.ManagerId = MAN.EmployeeId\r",
		"WHERE EMPM.EmployeeId = @employeeid\r",
		"\r",
		"SELECT ET.TransferId, ET.EmployeeId, ETM.ManagerId, \r",
		"Manager.Lastname + ' ' + Manager.Firstname 'Manager Name', \r",
		"ETM.IsNewManager,\r",
		"ETM.ManagerTypeId,\r",
		"ET.TransferDate, ET.Comment, ET.StatusId, ETS.Label, ET.CreatedDate, ET.IsDisabled\r",
		"\r",
		"FROM Employee_Transfer ET\r",
		"JOIN Employee_TransferStatus ETS ON ET.StatusId = ETS.TransferStatusId\r",
		"JOIN Employee_Transfer_Manager ETM ON ET.TransferId = ETM.TransferId\r",
		"JOIN Employee Manager ON ETM.ManagerId = Manager.EmployeeId\r",
		"\r",
		"WHERE ET.EmployeeId = @employeeid AND ETM.ManagerTypeId = @managerTypeId \r",
		"-- AND ET.StatusId = 3 \r",
		"AND (ET.IsDisabled = 0 OR ET.IsDisabled IS NULL)\r",
		"ORDER BY ET.TransferDate DESC"
	  ],
	  "description": "Employee Transfer Analysis"
	},
	"Fix clr enabled": {
	  "prefix": "Fix clr enabled",
	  "scope": "sql",
	  "body": [
		"EXEC sp_configure 'clr enabled', 1;  RECONFIGURE\r",
		"ALTER DATABASE SMART_Amaris SET trustworthy ON"
	  ],
	  "description": "Fix CLR SQL"
	},
	"Update By Pass": {
	  "prefix": "Update ByPass",
	  "scope": "sql",
	  "body": [
		"UPDATE [Security].[BypassRole]\r",
		"SET IsValidated = $1\r",
		"WHERE BypassRoleId IN ($2) "
	  ],
	  "description": "Update ByPass"
	},
	"Investigate Candidate Need": {
	  "prefix": "Investigate CandidateNeed",
	  "scope": "sql",
	  "body": [
		";WITH\r",
		"CandidateNeed(CandidateId, Firstname, Lastname, CandidateEmail, AdminFileId, HoldingId)\r",
		"AS\r",
		"(\r",
		"    SELECT Id, Firstname, Lastname, Email, AdminFileId, HoldingId  FROM Candidate WHERE StatusId = 8\r",
		")\r",
		"\r",
		"SELECT CN.CandidateId, CN.Firstname, CN.Lastname, CN.CandidateEmail, CN.AdminFileId, CN.HoldingId, NE.NeedId, NE.ManagerId, MAX([NE].UpdatedDate) as UpdatedDate\r",
		"                FROM [dbo].Event [EV]\r",
		"\t\t\t\tJOIN CandidateNeed CN on EV.CandidateID = CN.CandidateId\r",
		"                join [dbo].EventForNeed [EVFN] ON EVFN.EventId = EV.ID \r",
		"                JOIN [SMART].Need [NE] ON EVFN.NeedId = NE.NeedId and NE.StatusId = 2\r",
		"                where EV.ActionID = 27\r",
		"                group by CN.CandidateId, CN.Firstname, CN.Lastname, CN.CandidateEmail, CN.AdminFileId, CN.HoldingId, [NE].NeedId, NE.ManagerId"
	  ],
	  "description": "Investigate CandidateNeed"
	},
	"Create link between app": {
	  "prefix": "Create link between app",
	  "scope": "sql",
	  "body": [
		"USE [SMART_Amaris]\r",
		"GO\r",
		"\r",
		"INSERT INTO [Security].[FakeAuthentication_LinkedApplication]\r",
		"           ([ApplicationId]\r",
		"           ,[LinkedApplicationId])\r",
		"     VALUES\r",
		"           (29, 722)\r",
		"GO\r",
		"\r",
		"select * from CMDB_ParentBusinessServices where Description like 'Employee'\r",
		"select * from CMDB_ParentBusinessServices where Description like '%arian%'"
	  ],
	  "description": "Create link between app"
	},
	"Make super user": {
	  "prefix": "Make super user",
	  "scope": "sql",
	  "body": [
		"INSERT INTO CMDB_Admin (EmployeeId, Login, IsSuperAdmin) \r",
		"VALUES (6424,'hdang-pc\\hdang',1)"
	  ],
	  "description": "Make super user"
	},
	"Get WithTree": {
	  "prefix": "Get WithTree",
	  "scope": "sql",
	  "body": [
		"DECLARE @EmployeesSecured TABLE\r",
		"    (\r",
		"    \tEntityId int,\r",
		"\t\tRoleId bigint,\r",
		"\t\tBusinessRole int\r",
		"    );\r",
		"     \r",
		"INSERT INTO @EmployeesSecured\r",
		"EXEC [Security].[GetWithTree] Employee, $1\r",
		"\r",
		"SELECT Trigram, EMP.Lastname, EMP.Firstname, EMP.ManagerId FROM Employee EMP\r",
		"JOIN @EmployeesSecured ES ON EMP.EmployeeId = ES.EntityId"
	  ],
	  "description": ""
	},
	"Salary package analysis": {
	  "prefix": "Salary package analysis",
	  "scope": "sql",
	  "body": [
		"If(OBJECT_ID('tempdb..#SecuredEmployees') Is Not Null)\r",
		"Begin\r",
		"    Drop Table #SecuredEmployees\r",
		"End\r",
		"CREATE TABLE #SecuredEmployees\r",
		"(\r",
		"       EntityId int,\r",
		"       RoleId int,\r",
		"       BusinessRole int\r",
		")\r",
		"INSERT INTO #SecuredEmployees\r",
		"EXEC Security.GetWithTree 'Employee', $1, NULL, NULL, 'dbo', 'EmployeeId'\r",
		"\r",
		"If(OBJECT_ID('tempdb..#AllContracts') Is Not Null)\r",
		"BEGIN\r",
		"    DROP TABLE #AllContracts\r",
		"END\r",
		"CREATE TABLE #AllContracts\r",
		"(\r",
		"\tContractTypeId INT, Title VARCHAR(255), StartDate DATETIME2(7), EndDate DATETIME2(7), \r",
		"\tEmployeeId INT,\tEmployeeStatusId INT\r",
		")\r",
		"\r",
		"If(OBJECT_ID('tempdb..#PossibleSpContract') Is Not Null)\r",
		"BEGIN\r",
		"    DROP TABLE #PossibleSpContract\r",
		"END\r",
		"CREATE TABLE #PossibleSpContract\r",
		"(\r",
		"\tContractTypeId INT, Title VARCHAR(255), StartDate DATETIME2(7), EndDate DATETIME2(7), \r",
		"\tEmployeeId INT, PackageNumberForEmployee INT\r",
		")\r",
		"\r",
		"INSERT INTO #AllContracts\r",
		"\tSELECT CSP.ContractTypeId, CT.Title, CSP.StartDate, CSP.EndDate, CSP.EmployeeId, EMP.EmployeeStatusId\r",
		"\tFROM SalaryPackage.SalaryPackage [CSP] WITH(NOLOCK)\r",
		"\tLEFT OUTER JOIN ContractType [CT] \r",
		"\tON [CSP].[ContractTypeId] = [CT].[ContractTypeId]\r",
		"\tLEFT JOIN #SecuredEmployees SEMP ON SEMP.EntityId = CSP.EmployeeId\r",
		"\tLEFT JOIN Employee EMP ON EMP.EmployeeId = SEMP.EntityId\r",
		"\tWHERE \r",
		"\t([CSP].[IsDisabled] IS NULL OR [CSP].[IsDisabled] = 0) \r",
		"\tAND ([CSP].[StatusId] IS NULL OR [CSP].[StatusId] IN (2,3))\r",
		"\tAND [CSP].[ParentId] IS NULL\r",
		"\r",
		"\r",
		"--CURRENT\r",
		"INSERT INTO #PossibleSpContract\r",
		"SELECT CSP.ContractTypeId, [CSP].Title, CSP.StartDate, CSP.EndDate, CSP.EmployeeId,\r",
		"\tROW_NUMBER() OVER (PARTITION BY [CSP].[EmployeeId] ORDER BY [StartDate] DESC) AS [PackageNumberForEmployee]\r",
		"FROM #AllContracts [CSP] \r",
		"WHERE \r",
		"([CSP].StartDate <= CONVERT(date, getdate()) \r",
		"\tAND ([CSP].EndDate IS NULL OR CONVERT(date, [CSP].EndDate) >= CONVERT(date, getdate())\r",
		"OR [CSP].EmployeeStatusId = 4)) --If OUT we get the lastest, else we get the current\r",
		"\r",
		"--FUTURE\r",
		"INSERT INTO #PossibleSpContract\r",
		"SELECT CSP.ContractTypeId, [CSP].Title, CSP.StartDate, CSP.EndDate, CSP.EmployeeId,\r",
		"\tROW_NUMBER() OVER (PARTITION BY [CSP].[EmployeeId] ORDER BY [StartDate] DESC) AS [PackageNumberForEmployee]\r",
		"FROM #AllContracts [CSP] \r",
		"WHERE \r",
		"([CSP].EmployeeStatusId <> 4 -- Only get future package for employee that not out\r",
		"\tAND [CSP].StartDate > CONVERT(date, getdate()))\r",
		"AND CSP.EmployeeId NOT IN (SELECT CRSP.EmployeeId FROM #PossibleSpContract CRSP)\r",
		"\r",
		"--PREVIOUS\r",
		"INSERT INTO #PossibleSpContract\r",
		"SELECT CSP.ContractTypeId, [CSP].Title, CSP.StartDate, CSP.EndDate, CSP.EmployeeId,\r",
		"\tROW_NUMBER() OVER (PARTITION BY [CSP].[EmployeeId] ORDER BY [StartDate] DESC) AS [PackageNumberForEmployee]\r",
		"FROM #AllContracts [CSP] \r",
		"WHERE \r",
		"([CSP].StartDate < CONVERT(date, getdate()) AND CONVERT(date, [CSP].EndDate) < CONVERT(date, getdate()))\r",
		"AND CSP.EmployeeId NOT IN (SELECT CRSP.EmployeeId FROM #PossibleSpContract CRSP)\r",
		"\r",
		"SELECT * FROM #PossibleSpContract WHERE EmployeeId = $2 AND PackageNumberForEmployee = 1"
	  ],
	  "description": "Salary package analysis"
	},
	"Search FK dependencies": {
	  "prefix": "Search FK dependencies",
	  "scope": "sql",
	  "body": [
		"SELECT\r",
		"    FK_Table = FK.TABLE_NAME,\r",
		"    FK_Column = CU.COLUMN_NAME,\r",
		"    PK_Table = PK.TABLE_NAME,\r",
		"    PK_Column = PT.COLUMN_NAME,\r",
		"    Constraint_Name = C.CONSTRAINT_NAME\r",
		"FROM\r",
		"    INFORMATION_SCHEMA.REFERENTIAL_CONSTRAINTS C\r",
		"INNER JOIN INFORMATION_SCHEMA.TABLE_CONSTRAINTS FK\r",
		"    ON C.CONSTRAINT_NAME = FK.CONSTRAINT_NAME\r",
		"INNER JOIN INFORMATION_SCHEMA.TABLE_CONSTRAINTS PK\r",
		"    ON C.UNIQUE_CONSTRAINT_NAME = PK.CONSTRAINT_NAME\r",
		"INNER JOIN INFORMATION_SCHEMA.KEY_COLUMN_USAGE CU\r",
		"    ON C.CONSTRAINT_NAME = CU.CONSTRAINT_NAME\r",
		"INNER JOIN (\r",
		"            SELECT\r",
		"                i1.TABLE_NAME,\r",
		"                i2.COLUMN_NAME\r",
		"            FROM\r",
		"                INFORMATION_SCHEMA.TABLE_CONSTRAINTS i1\r",
		"            INNER JOIN INFORMATION_SCHEMA.KEY_COLUMN_USAGE i2\r",
		"                ON i1.CONSTRAINT_NAME = i2.CONSTRAINT_NAME\r",
		"            WHERE\r",
		"                i1.CONSTRAINT_TYPE = 'PRIMARY KEY'\r",
		"           ) PT\r",
		"    ON PT.TABLE_NAME = PK.TABLE_NAME\r",
		"WHERE C.CONSTRAINT_NAME like '$1'"
	  ],
	  "description": "Search FK dependencies"
	},
	"BillingTo Analylis": {
	  "prefix": "BillingTo Analylis",
	  "scope": "sql",
	  "body": [
		"-- * First check raw data from Billing To tables\r",
		"DECLARE @id INT = 11090\r",
		"SELECT * FROM Employee_BillingTo WHERE EmployeeId = @id\r",
		"SELECT * FROM BillingTo WHERE BillingToId \r",
		"IN (SELECT BillingToId FROM Employee_BillingTo WHERE EmployeeId = @id)\r",
		"\r",
		"-- ** Second check sp to get Billing data\r",
		"DECLARE @MyList TABLE\r",
		"(\r",
		"    Imputation varchar(50),\r",
		"    CompanyLabel varchar(50),\r",
		"    EmployeeId int,\r",
		"    EndDate datetime2(7),\r",
		"    Comment varchar(50)\r",
		");\r",
		"\r",
		"--Current billingto\r",
		";WITH\r",
		"CurrentBillingTo(Imputation, CompanyLabel, EmployeeId, EndDate, Comment)\r",
		"AS\r",
		"(\r",
		"    SELECT Imputation, CompanyLabel, EmployeeId, EndDate, Comment\r",
		"    FROM \r",
		"        (\r",
		"          SELECT i.Label 'Imputation', sb.Label 'CompanyLabel', ebt.EmployeeId, ebt.EndDate, 'current' as 'Comment'\r",
		"          FROM Employee_BillingTo ebt\r",
		"          LEFT JOIN dbo.BillingTo b ON b.BillingToId = ebt.BillingToId AND b.IsDisabled = 0\r",
		"          LEFT JOIN dbo.Employee_Imputation i ON i.ImputationId = b.ImputationId\r",
		"          LEFT JOIN Subsidiary.Subsidiary sb ON sb.SubsidiaryId = b.CompanyId\r",
		"          WHERE \r",
		"          --CONVERT(DATE, ebt.StartDate) <= CONVERT(DATE, GETDATE()) \r",
		"          (ebt.EndDate IS NULL OR CONVERT(DATE, ebt.EndDate) >= CONVERT(DATE, GETDATE())) \r",
		"          AND ebt.IsDisabled = 0 \r",
		"        ) AS T\r",
		")\r",
		"\r",
		"INSERT INTO @MyList(Imputation, CompanyLabel, EmployeeId, EndDate, Comment) \r",
		"(SELECT Imputation, CompanyLabel, EmployeeId, EndDate, Comment FROM CurrentBillingTo)\r",
		"\r",
		"\r",
		";WITH\r",
		"LastBillingTo(Imputation, CompanyLabel, EmployeeId, EndDate, Comment)\r",
		"AS\r",
		"(\r",
		"    SELECT Imputation, CompanyLabel, EmployeeId, EndDate, Comment\r",
		"    FROM \r",
		"        (\r",
		"          SELECT i.Label 'Imputation', sb.Label 'CompanyLabel', ebt.EmployeeId, \r",
		"          row_number() over(partition by ebt.EmployeeId order by ebt.EndDate desc) as rn, ebt.EndDate, 'last' as 'Comment'\r",
		"          FROM Employee_BillingTo ebt\r",
		"          LEFT JOIN dbo.BillingTo b ON b.BillingToId = ebt.BillingToId AND b.IsDisabled = 0\r",
		"          LEFT JOIN dbo.Employee_Imputation i ON i.ImputationId = b.ImputationId\r",
		"          LEFT JOIN Subsidiary.Subsidiary sb ON sb.SubsidiaryId = b.CompanyId\r",
		"          WHERE ebt.IsDisabled = 0 AND ebt.EndDate IS NOT NULL\r",
		"        ) AS T\r",
		"    WHERE rn = 1     \r",
		")\r",
		"\r",
		"INSERT INTO @MyList(Imputation, CompanyLabel, EmployeeId, EndDate, Comment) \r",
		"(SELECT Imputation, CompanyLabel, EmployeeId, EndDate, Comment FROM LastBillingTo lbt\r",
		" WHERE EmployeeId NOT IN (SELECT EmployeeId FROM @MyList ml WHERE lbt.EmployeeId = ml.EmployeeId\r",
		" AND ml.Comment LIKE 'current')\r",
		")\r",
		"\r",
		"SELECT * FROM @MyList \r",
		"ORDER BY EmployeeId"
	  ],
	  "description": "BillingTo Analylis"
	},
	
  }